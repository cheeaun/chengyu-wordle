var me=Object.defineProperty,fe=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ne=(o,s,n)=>s in o?me(o,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[s]=n,K=(o,s)=>{for(var n in s||(s={}))ge.call(s,n)&&ne(o,n,s[n]);if(te)for(var n of te(s))we.call(s,n)&&ne(o,n,s[n]);return o},W=(o,s)=>fe(o,pe(s));import{j as ye,a as be,F as ve,l as C,y as E,d as T,p as ke,S as Ce}from"./vendor.cfb7979a.js";import{i as Ie}from"./all-idioms.effcc4de.js";import{d as Se}from"./game-idioms.4b614f9d.js";const Ee=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))y(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const w of l.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&y(w)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function y(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}};Ee();const e=ye,a=be,L=ve,S=o=>ke(o,{segment:!0,group:!0}).flat().join(" ").trim(),Fe=Ie.split(`
`),I=Se.slice(1).map(o=>({id:o[0],idiom:o[1]})),J=4,j=20,M=6,F="cywd-";window.clearGames=()=>{for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s.startsWith(F)&&localStorage.removeItem(s)}};window.allGames=()=>{const o=new Map;for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);if(n.startsWith(F)){const y=JSON.parse(localStorage.getItem(n));o.set(n.replace(F,""),y)}}return o};const re=(o,s)=>{const n=typeof s=="string"?s.split(""):s,y=typeof o=="string"?o.split(""):o,r=n.length,l=Array.from({length:r},()=>"\u2B1C");if(r!==y.length)throw new Error("idioms must have the same length");const w=[];for(let p=0;p<r;p++){const h=n[p],b=y[p];h===b&&(l[p]="\u{1F7E9}",w.push(p))}const c=[];for(let p=0;p<r;p++){const h=n[p],b=y[p];if(h!==b){const f=y.indexOf(h);f!==-1&&!w.includes(f)&&!c.includes(f)&&(l[p]="\u{1F7E7}",c.push(f))}}return l};window.getIdiomStates=re;const oe=o=>{if(o.some(r=>!!r.length&&r.every(l=>l==="\u{1F7E9}")))return"won";const n=o[o.length-1];return!!n.length&&n.every(r=>r!=="\u{1F7E9}")?"lost":null},ie=()=>Array.from({length:M},()=>({v:Array.from({length:J},()=>""),s:!1})),X=(o,s,n,y=0)=>{var p;let r=s||new Set;r.add(o);let l=n||new Set;const w=o.split("");w.forEach(h=>l.add(h));let c=0;e:for(let h=0;h<I.length;h++){const b=w[(h+1)%J],f=I.find(({idiom:v})=>!r.has(v)&&v.includes(b));if(f){for(let v=0;v<f.idiom.length;v++)if(l.add(f.idiom[v]),l.size>=j)break e;r.add(f.idiom),c=0}else{if(c>=J+1)break e;c+=1}}if(l.size<j||r.size<M){const h=[...r][++y];if(h){const{passedIdioms:b,keys:f}=X(h,r,l,y);r=b,l=f}}if(l.size<j||r.size<M){const h=I[Math.floor(Math.random()*I.length)].idiom;if(h){const{passedIdioms:b,keys:f}=X(h,r,l,0);r=b,l=f}}if(l.size<j||r.size<M){const h=(p=I.find(b=>b.idiom===o))==null?void 0:p.id;console.error(h,{possibleIdioms:r.size,keySize:l.size,consecutiveFailures:c})}return{passedIdioms:r,keys:l}},_=o=>a("svg",W(K({viewBox:"0 0 20 20",fill:"currentColor"},o),{children:[e("title",{children:"\u25B6\uFE0F"}),e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"})]})),se=o=>a("svg",W(K({viewBox:"0 0 24 24"},o),{children:[e("title",{children:"\u2716\uFE0F"}),e("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})]})),le=new Date(2022,0,27),N=()=>{const s=new Date().setHours(0,0,0,0)-le,n=Math.floor(s/(1e3*60*60*24));return I[Math.max(0,n%I.length)]},$e=()=>{let o=new Date().setHours(0,0,0,0)+24*60*60*1e3;const s=new Date(+le+24*60*60*1e3);o<s&&(o=s);const[n,y]=C("00"),[r,l]=C("00"),[w,c]=C("00"),[p,h]=C(!1);return E(()=>{const b=setInterval(()=>{const f=o-new Date;if(f<=0){h(!0),clearInterval(b);return}y(Math.floor(f/(1e3*60*60)).toString().padStart(2,"0")),l(Math.floor(f/(1e3*60)%60).toString().padStart(2,"0")),c(Math.floor(f/1e3%60).toString().padStart(2,"0"))},1e3);return()=>clearInterval(b)},[]),p?e("a",{href:"./",children:"Now!"}):a("time",{class:"countdown",children:[n,":",r,":",w]})},ce=({code:o,url:s})=>o&&e("input",{readOnly:!0,value:o,class:"idiom-code",onClick:n=>{n.target.focus(),n.target.select(),navigator.clipboard.writeText(s||o).then(()=>{alert("Copied URL to clipboard")}).catch(y=>{})}});function xe(){var Q;const[o,s]=C(localStorage.getItem(`${F}skipFirstTime`)||!1),[n,y]=C(I.find(t=>t.id===location.hash.slice(1))||N());E(()=>{window.addEventListener("hashchange",()=>{y(I.find(t=>t.id===location.hash.slice(1))||N())})},[]);const[r,l]=C(((Q=JSON.parse(localStorage.getItem(`${F}${n.id}`)))==null?void 0:Q.board)||ie());E(()=>{const t=localStorage.getItem(`${F}${n.id}`);l(t?JSON.parse(t).board:ie())},[n.id]);const w=T(()=>r.map((t,i)=>t.s?re(n.idiom,t.v):[]),[r]);E(()=>{r&&r.some(t=>t.v.some(i=>i))&&localStorage.setItem(`${F}${n.id}`,JSON.stringify({board:r,gameState:oe(w)}))},[w]);const[c,p]=C(null);E(()=>{p(null),fetch(`https://baidu-hanyu-idiom.cheeaun.workers.dev/?wd=${n.idiom}`).then(t=>t.json()).then(t=>{t.definition&&p(t.definition)})},[n.idiom]);const h=(r==null?void 0:r.findIndex(t=>t.s===!1))||0,[b,f]=C(!1),[v,$]=C(!1),[ae,G]=C(!1),z=T(()=>{const{passedIdioms:t,keys:i}=X(n.idiom),d=[...t].map(u=>`${u} (${S(u)})`).sort((u,m)=>u.localeCompare(m,"zh"));return console.log(`POSSIBLE IDOMS [${n.id}] (${i.size} keys):
${d.map((u,m)=>`${m+1}. ${u}`).join(`
`)}

\u{1F6A8}SPOILER\u{1F6A8} Type 'ANSWER' to see the answer.
`),window.ANSWER=`${n.idiom} (${S(n.idiom)})`,[...i].sort((u,m)=>u.localeCompare(m,"zh"))},[n.idiom]),O=(t,i=!1)=>{if(!r[h]||k)return;const d=[...r];let u=d[h].v.findIndex(m=>m==="");i&&(u===-1?u=3:u--),u!==-1&&(d[h].v[u]=t,l(d))},B=new Set,H=new Set,P=new Set;r.forEach((t,i)=>{!t.s||t.v.forEach((d,u)=>{const m=w[i][u];m==="\u{1F7E9}"?B.add(d):m==="\u{1F7E7}"?H.add(d):m==="\u2B1C"&&P.add(d)})});const U=()=>{if(k)return;console.log("handleEnter"),f(!1);const t=r[h],i=t.v.join(""),d=Fe.includes(i);d?(t.s=!0,l([...r])):setTimeout(()=>{f(!0)},10),console.log({currentIdiom:i,valid:d})},k=T(()=>oe(w),[w]);E(()=>{$(k==="won"?"won":k==="lost"?"lost":!1)},[k]);const Y=()=>{if(k)return;const t=[...r],i=t[h];if(!i||i.s)return;let d=-1;for(let u=i.v.length-1;u>=0;u--)if(i.v[u]!==""){d=u;break}d!==-1&&(i.v[d]="",l(t))};E(()=>{document.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),t.stopPropagation())})},[]),E(()=>{const t=i=>{if(k||i.metaKey||i.ctrlKey||!i.key)return;const d=i.key.toLowerCase();if(d==="enter")i.preventDefault(),i.stopPropagation(),U();else if(d==="backspace")i.preventDefault(),Y();else if(/^arrow(left|right)/i.test(d)){const m=[...r[h].v].reverse().find(g=>g!=="");if(m){const g=S(m)[0],x=z.filter(ue=>S(ue)[0]===g);if(x.length<=1)return;const Z=x.indexOf(m),ee=d==="arrowright"?x[(Z+1)%x.length]:x[(Z+x.length-1)%x.length];ee&&O(ee,!0)}}else{const u=z.find(m=>S(m)[0].localeCompare(d,"en",{sensitivity:"base"})===0);u&&(i.preventDefault(),O(u))}};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[z,h,k]);const R=location.origin+location.pathname+"#"+n.id,q=w.map(t=>t.join("")).join(`
`).trim(),de=k==="won"?q.split(`
`).length:"X",A=`${`Chengyu Wordle [${n.id}] ${de}/6

${q}`}

${R}`,V=T(()=>{const t=[],i=n.idiom.split(""),d=z.filter(g=>!i.includes(g)&&!P.has(g)).slice(0,-1).slice(0,3).map(g=>`\u274C The letter ${g} (${S(g)}) is NOT in the idiom.`).sort(()=>Math.random()-.5);t.push(...d),(c==null?void 0:c.zh)&&i.filter(g=>c.zh.includes(g)).length<=2&&t.push(`\u2139\uFE0F ${c.zh}`),(c==null?void 0:c.en)&&t.push(`\u2139\uFE0F ${c.en}`);const u=i.filter(g=>!B.has(g)&&!H.has(g)).slice(0,-1).map(g=>`\u2705 The letter ${g} (${S(g)}) is in the idiom.`).sort(()=>Math.random()-.5);t.push(...u);const m=i.map(g=>S(g)[0]).join("").normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t.push(`\u2728 Abbreviated pinyin: ${m}`),t},[B,n.idiom,c]),D=C(0);E(()=>{D.current=0},[n.idiom]);const he=()=>{if(k)return;const t=V[D.current];D.current=(D.current+1)%V.length,alert(t)};return a(L,{children:[a("header",{children:[e("button",{type:"button",onClick:()=>{G(!0)},children:a("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e("title",{children:"\u2139\uFE0F"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),a("h1",{children:["Chengyu Wordle ",e("sup",{children:"beta"})]}),e("button",{type:"button",onClick:()=>{$(k||"play")},children:"Play"})]}),e("div",{id:"board",children:r.map((t,i)=>e("div",{className:`row ${h===i&&b?"error":""} ${h===i?"current":""}`,children:t.v.map((d,u)=>{var m;return e("div",{className:`letter ${d!=null?d:"lettered"} ${(m=w[i][u])!=null?m:""}`,children:a("ruby",{children:[d||e("span",{style:{opacity:0},children:"\u4E00"}),e("rp",{children:"("}),e("rt",{children:S(d)||e(L,{children:"\xA0"})}),e("rp",{children:")"})]})},u)})},i))}),e("div",{id:"keyboard",children:a("div",{class:"inner",children:[e("div",{class:"keys",children:z.map((t,i)=>e("button",{class:`${B.has(t)?"\u{1F7E9}":""} ${H.has(t)?"\u{1F7E7}":""} ${P.has(t)?"\u2B1C":""}`,type:"button",tabIndex:-1,onClick:()=>{O(t)},children:a("ruby",{children:[t,e("rp",{children:"("}),e("rt",{children:S(t)}),e("rp",{children:")"})]})}))}),a("div",{class:"row",children:[e("button",{type:"button",onClick:U,tabIndex:-1,children:"Enter"}),e("button",{type:"button",class:"stuck",onClick:he,children:"I'm stuck"}),e("button",{type:"button",onClick:Y,tabIndex:-1,children:e("svg",{height:"24",viewBox:"0 0 24 24",width:"24",children:e("path",{d:"M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H7.07L2.4 12l4.66-7H22v14zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z"})})})]})]})}),a("div",{id:"modal",class:v?"appear":"",onClick:t=>{t.target===t.currentTarget&&$(null)},children:[e(se,{height:"24",width:"24",class:"close",onClick:()=>{$(null)}}),a("div",{class:"content",children:[e("h2",{children:v==="won"?"\u{1F389}\u{1F389}\u{1F389}":v==="lost"?"\u{1F62D}\u{1F62D}\u{1F62D}":"\u{1F47E}\u{1F47E}\u{1F47E}"}),v==="play"&&e("p",{children:e(ce,{code:n.id,url:R})}),/(won|lost)/i.test(v)&&a(L,{children:[a("p",{children:[e("b",{class:"answer",children:a("ruby",{children:[n.idiom,e("rp",{children:"("}),e("rt",{children:S(n.idiom)}),e("rp",{children:")"})]})}),a("div",{class:"definition",children:[c==null?void 0:c.zh,(c==null?void 0:c.zh)&&(c==null?void 0:c.en)&&e("br",{}),c==null?void 0:c.en]}),a("small",{children:[(c==null?void 0:c.zh)||(c==null?void 0:c.en)?"Source:":"\u{1F4D6}"," ",e("a",{href:`https://hanyu.baidu.com/s?wd=${n.idiom}&from=zici`,target:"_blank",children:"Baidu"})]})]}),e("div",{class:"results",children:A}),a("button",{id:"share",onClick:async()=>{try{await navigator.share({text:A})}catch{try{await navigator.clipboard.writeText(A),alert("Copied results to clipboard")}catch{}}},children:["Share"," ",e("svg",{height:"16",width:"16",viewBox:"0 0 24 24",children:e("path",{fill:"currentColor",d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"})})]}),"\xA0\xA0",e("a",{class:"button tweet",href:`https://twitter.com/intent/tweet?text=${encodeURIComponent(A)}`,target:"_blank",children:a("svg",{height:"16",width:"16",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e("title",{children:"Tweet"}),e("path",{fill:"currentColor",d:"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"})]})}),"\xA0\xA0",e(ce,{code:n.id,url:R})]}),a("div",{class:"footer",children:[/won|lost/i.test(k)&&N().id===n.id&&e("p",{children:a("big",{children:["Next idiom:"," ",e("b",{children:e($e,{})})]})}),a("div",{children:[N().id!==n.id&&a(L,{children:[a("a",{href:"./",class:"button",children:[e(_,{width:20,height:20})," Play today's game!"]}),e("br",{})]}),a("button",{type:"button",onClick:()=>{if(confirm("Are you sure you want to start a new random game?")){const i=Math.round(Math.random()*(I.length-1)),d=I[i];location.hash=`#${d.id}`,$(null)}},children:[e(_,{width:20,height:20})," Random"]})," ",a("button",{type:"button",onClick:()=>{let t=prompt("Enter idiom ID/URL:");try{t=new URL(t).hash.slice(1)}catch{}if(t){const i=I.find(d=>d.id===t);i?(location.hash=`#${i.id}`,$(null)):alert("Invalid idiom ID")}},children:[e(_,{width:20,height:20})," Choose"]})]})]})]})]}),a("div",{id:"info-modal",class:ae||!o?"appear":"",children:[o&&e(se,{height:"24",width:"24",class:"close",onClick:()=>{G(!1)}}),a("div",{class:"content",children:[e("h2",{children:"How to play"}),a("p",{children:["Guess the idiom in ",M," tries."]}),e("p",{children:"Each guess must be a valid 4-letter idiom. Hit the enter button to submit."}),e("p",{children:"After each guess, the color of the tiles will change to show how close your guess was to the idiom."}),a("ul",{children:[e("li",{children:"\u{1F7E9}\u2B1C\u2B1C\u2B1C Green = correct spot"}),e("li",{children:"\u2B1C\u{1F7E7}\u2B1C\u2B1C Yellow = wrong spot"}),a("li",{children:["\u2B1C\u2B1C",e("span",{style:{opacity:.5},children:"\u2B1B"}),"\u2B1C Gray = not in any spot"]})]}),e("p",{children:"A new idiom will be available every day."}),o?a(L,{children:[e("h2",{children:"About"}),a("p",{children:[e("a",{href:"https://github.com/cheeaun/chengyu-wordle/",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://cheeaun.com",target:"_blank",children:"Chee Aun"}),"."," ",e("a",{href:"https://www.powerlanguage.co.uk/wordle/",target:"_blank",children:"Wordle"})," ","\xA9\uFE0F"," ",e("a",{href:"https://powerlanguage.co.uk/",target:"_blank",children:"Josh Wardle"}),"."]}),e("h2",{children:"Feedback channels"}),a("ul",{children:[e("li",{children:e("a",{href:"https://t.me/+ykuhfiImLd1kNjk1",target:"_blank",children:"Telegram group"})}),a("li",{children:[e("a",{href:"https://github.com/cheeaun/chengyu-wordle/discussions",target:"_blank",children:"GitHub Discussions"}),"(for developers)"]}),a("li",{children:[e("a",{href:"https://github.com/cheeaun/chengyu-wordle/issues",target:"_blank",children:"GitHub Issues"})," ","(for bugs)"]}),e("li",{children:e("a",{href:"https://twitter.com/cheeaun",target:"_blank",children:"@cheeaun on Twitter"})}),e("li",{children:e("a",{href:"https://t.me/cheeaun",target:"_blank",children:"@cheeaun on Telegram"})})]}),e("h2",{children:"Debugging"}),e("button",{type:"button",onClick:()=>{confirm("Are you sure?")&&(localStorage.removeItem(F+n.id),location.reload())},children:"Reset current idiom game"}),"\xA0",e("button",{type:"button",onClick:()=>{confirm("Are you sure?")&&(clearGames(),location.reload())},children:"Clear database"})]}):e("p",{children:a("button",{type:"button",class:"large",onClick:()=>{G(!1),localStorage.setItem(F+"skipFirstTime",1),s(!0)},children:[e(_,{width:"20",height:"20"})," Let's play!"]})})]})]})]})}Ce(e(xe,{}),document.getElementById("app"));
//# sourceMappingURL=index.feec2346.js.map
